---
title: Redis 레디스
category: CS
tag: TIL
---

[참고 : 우아한 테크톡](https://youtu.be/Gimv7hroM8A)
[참고 : 우아한 세미나](https://youtu.be/mPB2CZiAkKM)

## cache

### cache 구조 1 - Look aside Cache

1. 웹서버는 데이터가 존재하는지 캐시를 먼저 확인
2. 캐시에 데이터가 있으면 캐시에서 가져온다.
3. 캐시에 데이터가 없으면 데이터베이스에서 가져온다.
4. 데이터베이스에서 가져온 데이터를 캐시에 다시 저장한다.

### cache 구조 2 - Write back

1. 웹서버는 모든 데이터를 캐시에만 저장
2. 캐시에 특정 시간동안의 데이터가 저장한다
3. 캐시에 있는 데이터를 데이터베이스에 저장한다.
4. 데이터베이스에 저장된 데이터를 삭제한다.

장애가 생기면 데이터가 날라가 유실될 위험이 있다.

### 캐싱에 적합한 데이터

- 반복적이고 동일한 결과가 나오는 기능의 반환값
- 업데이트가 자주 발생하지 않는 데이터
- 자주 조회되는 데이터

## Redis

`Redis`는 Remote Dictionary Server의 약자로 key-value 기반의 인메모리 데이터 저장소다. key-value 기반이기 때문에 쿼리를 처리할 필요없이 결과를 바로 가져올 수 있다. 또한, 디스크에 데이터를 쓰는 구조가 아니라 메모리에서 데이터를 처리하기 때문에 속도가 빠르다.

<img src='https://ww.namu.la/s/893cc4cb9901911dd7fbf7e151f8768f0a10d00d6b50bc9ad2b634810c19723f7c5464bc7701d8cfbfa7a4c3027ec10198c1cfcb92b598bd0eccea6202beb28abadf35a1a41eb947122994c9fcdae8fac69117469cdad441f284ae97440d6f07'>


기본적으로 데이터를 하드디스크(SSD)에 저장한다. 하드디스크는 용량이 크고 전원이 꺼져도 데이터가 유지되지만 속도가 느리다. 기술이 발달하면서 메인 메모리에 데이터를 저장해 쉽고 빠르게 접근할 수 있지 않을까하는 생각에 생긴 개념이 Redis이다.

> Database보다 더 빠른 메모리에 더 자주 접근하고 덜 자주 바뀌는 데이터를 저장하자! 

## Redis의 데이터 구조 - collections

<img src='https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbsxKIM%2FbtqE9u1RqHA%2Fpd48khq1lAJsdtcbg3LsE1%2Fimg.png'>

아래는 values에 올 수 있는 데이터 타입들이다. 

### 1. Strings
문자열로 단순한 key-value 매핑 구조가 된다.

### 2. Lists 
`Linked List`와 같은 형태로 Array형식이다. 

### 3. Sets
중복과 순서가 없는 String 데이터 집합이다. 

### 4. Sorted Sets
`set`과 비슷하지만 key, value, score까지 저장하고 이 score값을 통해 정렬한다.

### 5. Hashes
field-value 쌍의 hash 형태로 저장한다. key의 field 개수에 제한이 없다. key-value 구조를 여러 개 가진 object 타입을 저장할 때 편리하다.


## Redis 관리

Redis는 싱글 스레드이기 때문에 한 번에 하나의 명령을 실행하는 특징이 있다. Redis의 자료구조는 Atomic Critical Section에 대한 동기화를 제공하기 때문에 여러 트랜잭션의 Read와 Write를 오류없이 실행할 수 있다. 대신 싱글 스레드 서버라 시간 복잡도를 고려해야 하고 
Redis를 효율적으로 다루기 위해서 OS와 메모리에 대한 배경지식이 필요하다.


여러 서버에서 같은 데이터를 공유할 때나 Atomic 자료구조 , Cache 기능을 사용하기 위해 Redis를 선택한다.