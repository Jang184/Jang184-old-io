---
title: 서버리스 백엔드 개발
category: serverless
tag: TIL
---

## 서버리스 아키텍처 개요

> [참고 : 서버리스 공식 블로그](https://www.serverless.com/blog/serverless-architecture-code-patterns)

서버리스 아키텍처를 위한 4가지의 접근법
- 나노서비스 : 각 기능마다 각자의 람다 함수가 있다.
- 마이크로서비스 : 각 람다가 단일 자원의 모든 HTTP 요청을 처리한다.
- 모놀리스 : 모놀리스는 하나의 람다 함수가 모든 기능들을 처리한다.
- 그래프 : 그래프는 REST API의 대안인 그래프QL 표준을 사용한다.

> 나노서비스 \< 마이크로서비스 \< 모놀리스

서버리스 아키텍쳐를 선택할 때 애플리케이션이 람다 함수를 하나만 실행하게 할 것인지 혹은 다중 람다 함수를 갖게 할 것인지부터 결정해야 한다. 람다 함수의 수는 배포 단위의 수를 나타낸다.


`모놀리스`는 모든 기능이 단일 솔루션으로 개발돼 코드 일부를 수정하면 전체 솔루션을 새로 배포해야 하는 독립형 애플리케이션이다.
`마이크로서비스`는 그 반대의 개념으로 별도로 배포할 수 있는 여러 개의 단위가 있으며, 각 단위는 전체 솔루션의 고유한 부분을 담당한다.



일반적으로 마이크로서비스의 장점은 다음과 같다.


- 관심사와 모듈성의 분리 개선
- 독립적인 수시 배포
- 팀을 분리해 좀 더 수월하게 개발

## 서버리스 애플리케이션 보안

### 보안 기초

실제 프로덕션 시스템에서 사용자가 직접 개발한 알고리즘이나 보안 모델을 사용하면 안된다. 항상 신뢰할 수 있는 출처로부터 , 많이 사용되고 테스트된 솔루션을 사용해야 한다.

### 정보 보안

보안을 다룰 때 고려해야할 몇 가지 사항을 기술한다.

- 인증 (Authentication) : 사용자가 자신이 주장하는 사람임을 확인해 신원을 확인하는 속성
- 권한부여 (Authorization) : 사용자가 요청한 작업을 실행할 수 있는지 결정하는 속성
- 기밀성 (Confidentiality) : 제3자가 데이터를 이해할 수 없도록 보장하는 속성
- 무결성 (Integrity) : 감지할 수 없는 변조로부터 메세지를 보호하는 속성
- 부인방지 (Non-repudiation) : 누군가가 자신의 메세지 진위성을 부정할 수 없도록 보장하는 속성
- 가용성 (Availability) : 필요할 때 시스템을 사용할 수 있게 하는 속성

#### 1. 인증

로그인 양식을 통해 사용자의 신원을 확인하는 전통적인 방식으로 충분하다. 그러나 사용자의 모든 요청에 자격증명을 요청할 수 없기 때문에 첫 번째 요청에서 인증하는 동안 다음 요청에 사용될 `보안 토큰`을 만들어야 한다. 이 토큰은 클라이언트에 쿠키로 저장되며 이후 모든 요청은 자동으로 서버로 전송된다.



AWS에서 이 토큰은 `Cognito` 서비스를 사용해 만들 수 있다.

#### 2. 권한부여

백엔드에서 요청이 수신되면 사용자가 요청한 작업을 실행할 수 있는지 확인한다. 애플리케이션에 대한 여러 역할을 갖고 있을 때, 데이터 접근 권한을 제한해야 할 필요가 있다. 예를 들어 학교 성적 관리 시스템은 학생과 교사 두 가지 역할로 구현될 수 있다.

#### 3. 기밀성

모든 요청을 처리하기 위해 HTTPS를 사용해 웹사이트를 개발하는 것이 사용자와 사이트의 통신에 기밀성을 달성하는 주요 기법이다. HTTPS를 사용하는 것은 데이터가 암호화되기 때문에 악의적인 사용자가 내용을 해독하고 이해하는 것이 매우 어렵다.


#### 4. 무결성

무결성은 기밀성과 관련이 있다. 기밀성은 다른 사용자가 내용에 접근하지 못하도록 메세지를 암호화하는 데 의존하지만, 무결성은 디지털 서명을 사용해 암호화하며 변조로부터 메세지를 보호한다.

#### 5. 부인방지

부인방지는 인증과 자주 혼동되지만 인증은 기술적인 측면과 더 많은 연관이 있고 부인방지 개념은 법적 용어, 책임, 감사와 더 많은 연관이 있다.



사용자의 이름과 비밀번호가 입력된 로그인 양식이 있을 때, 해당 조합을 통해 사용자가 맞는지 인증할 수 있지만, 서드파티가 자격증명을 정확하게 추측하거나 도난당할 경우 100% 증명할 수 없다. 반면에 생체 인증 방법처럼 더 진화된 부인방지 메커니즘을 사용하면 접근제한 메커니즘이 더 강력해진다. 

#### 6. 가용성

가용성은 공격자의 공격을 지속적으로 받을 수 있으며, 악의적인 공격자에 의해 중단될 수도 있다. 사이트의 가용성을 방해해 병목 현상을 만드는 것이 목표인 DDoS와 같은 공격이 있다.

## 서버리스 배포

### 함수웜업

> [참고 : 서버리스 공식 블로그](https://www.serverless.com/blog/keep-your-lambdas-warm)

서버리스 함수의 문제점 중 하나가 `콜드 스타트`다. 람다 함수가 실행되면 AWS는 패키지를 찾아 압축을 풀고 실행할 컨테이너에 설치한다. 이 단계는 시간이 걸리고 함수 실행이 지연된다.


함수를 실행한 후 AWS는 잠시 동안 일시 중지 상태가 된다. 몇 분 후에 새 요청을 하면 패키지를 즉시 사용할 수 있으므로 콜드 스타트 지연이 발생하지 않는다. 애플리케이션 응답 시간이 짧아야 하는 경우 애플리케이션을 웜업할 수 있도록 구성할 수 있다.